/*! @asymmetrik/angular2-leaflet-1.1.0 - Copyright Asymmetrik, Ltd. 2007-2017 - All Rights Reserved.*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("leaflet")):"function"==typeof define&&define.amd?define(["exports","@angular/core","leaflet"],t):t(e.angular2Sentio=e.angular2Sentio||{},e.ng.core,e.L)}(this,function(e,t,r){"use strict";e.LeafletDirective=function(){function e(e){this.DEFAULT_ZOOM=1,this.DEFAULT_CENTER=r.latLng([38.907192,-77.036871]),this.DEFAULT_FPZ_OPTIONS={},this.fitBoundsOptions=this.DEFAULT_FPZ_OPTIONS,this.panOptions=this.DEFAULT_FPZ_OPTIONS,this.zoomOptions=this.DEFAULT_FPZ_OPTIONS,this.zoomPanOptions=this.DEFAULT_FPZ_OPTIONS,this.options={},this.mapReady=new t.EventEmitter,this.element=e}return e.prototype.ngOnInit=function(){this.map=r.map(this.element.nativeElement,this.options),null!=this.center&&null!=this.zoom&&this.setView(this.center,this.zoom),null!=this.fitBounds&&this.setFitBounds(this.fitBounds),this.doResize(),this.mapReady.emit(this.map)},e.prototype.ngOnChanges=function(e){e.zoom&&e.center&&null!=this.zoom&&null!=this.center?this.setView(e.center.currentValue,e.zoom.currentValue):e.zoom?this.setZoom(e.zoom.currentValue):e.center&&this.setCenter(e.center.currentValue),e.fitBounds&&this.setFitBounds(e.fitBounds.currentValue)},e.prototype.getMap=function(){return this.map},e.prototype.onResize=function(){this.delayResize()},e.prototype.doResize=function(){this.map.invalidateSize({})},e.prototype.delayResize=function(){null!=this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.doResize.bind(this),200)},e.prototype.setView=function(e,t){this.map&&null!=e&&null!=t&&this.map.setView(e,t,this.zoomPanOptions)},e.prototype.setZoom=function(e){this.map&&null!=e&&this.map.setZoom(e,this.zoomOptions)},e.prototype.setCenter=function(e){this.map&&null!=e&&this.map.panTo(e,this.panOptions)},e.prototype.setFitBounds=function(e){this.map&&null!=e&&this.map.fitBounds(e,this.fitBoundsOptions)},e}(),__decorate([t.Input("leafletFitBoundsOptions"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"fitBoundsOptions",void 0),__decorate([t.Input("leafletPanOptions"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"panOptions",void 0),__decorate([t.Input("leafletZoomOptions"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"zoomOptions",void 0),__decorate([t.Input("leafletZoomPanOptions"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"zoomPanOptions",void 0),__decorate([t.Input("leafletOptions"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"options",void 0),__decorate([t.Output("leafletMapReady"),__metadata("design:type",Object)],e.LeafletDirective.prototype,"mapReady",void 0),__decorate([t.Input("leafletZoom"),__metadata("design:type",Number)],e.LeafletDirective.prototype,"zoom",void 0),__decorate([t.Input("leafletCenter"),__metadata("design:type",r.LatLng)],e.LeafletDirective.prototype,"center",void 0),__decorate([t.Input("leafletFitBounds"),__metadata("design:type",r.LatLngBounds)],e.LeafletDirective.prototype,"fitBounds",void 0),__decorate([t.HostListener("window:resize",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.LeafletDirective.prototype,"onResize",null),e.LeafletDirective=__decorate([t.Directive({selector:"[leaflet]"}),__metadata("design:paramtypes",[t.ElementRef])],e.LeafletDirective);var n=function(){function e(e){this.leafletDirective=e}return e.prototype.init=function(){},e.prototype.getMap=function(){return this.leafletDirective.getMap()},e}(),i=function(){function e(e,t){this.remove=e,this.add=t}return e}(),o=function(){function e(){}return e.diffLayers=function(e,t){var r,n;return null==e&&(e=[]),null==t&&(t=[]),r=t.filter(function(t){return!e.find(function(e){return t===e})}),n=e.filter(function(e){return!t.find(function(t){return e===t})}),new i(r,n)},e}(),a=function(){function e(e){this.leafletDirective=new n(e)}return e.prototype.ngOnInit=function(){this.leafletDirective.init(),this.setLayers(this.layers,[])},e.prototype.ngOnChanges=function(e){if(e.layers){var t=e.layers.currentValue,r=e.layers.isFirstChange()?[]:e.layers.previousValue;this.setLayers(t,r)}},e.prototype.setLayers=function(e,t){var r=this.leafletDirective.getMap();if(null!=r){var n=o.diffLayers(e,t);n.remove.forEach(function(e){r.removeLayer(e)}),n.add.forEach(function(e){r.addLayer(e)})}},e}();__decorate([t.Input("leafletLayers"),__metadata("design:type",Array)],a.prototype,"layers",void 0),a=__decorate([t.Directive({selector:"[leafletLayers]"}),__metadata("design:paramtypes",[e.LeafletDirective])],a);var s=function(){function e(){}return e.mergeMaps=function(e,t){var r={};if(null!=e)for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);if(null!=t)for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},e.mapSubtract=function(e,t){var r={};if(null!=e){for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);if(null!=t)for(var n in t)t.hasOwnProperty(n)&&delete r[n]}return r},e.mapToArray=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t},e}(),l=function(){function e(e,t){this.remove=e,this.add=t}return e}(),p=function(){function e(){}return e.prototype.getLayersControl=function(){return this.layersControl},e.prototype.init=function(e,t){var n=e.baseLayers||{},i=e.overlays||{};return this.layersControl=r.control.layers(n,i,t),this.layersControl},e.prototype.setLayersControlConfig=function(e,t){if(null==this.layersControl)return new l({},{});var r,n,i;r=s.mergeMaps(s.mapSubtract(t.baseLayers,e.baseLayers),s.mapSubtract(t.overlays,e.overlays)),n=s.mapSubtract(e.baseLayers,t.baseLayers),i=s.mapSubtract(e.overlays,t.overlays);for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];this.layersControl.removeLayer(a)}for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];this.layersControl.addBaseLayer(a,o)}for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];this.layersControl.addOverlay(a,o)}return new l(r,s.mergeMaps(n,i))},e}(),u=function(){function e(e){this.leafletDirective=new n(e),this.controlLayers=new p}return e.prototype.ngOnInit=function(){this.leafletDirective.init(),this.controlLayers.init(this.layersControlConfig,this.layersControlOptions).addTo(this.leafletDirective.getMap())},e.prototype.ngOnChanges=function(e){e.layersControlCfg&&this.controlLayers.setLayersControlConfig(e.layersControlCfg.currentValue,e.layersControlCfg.previousValue)},e}();__decorate([t.Input("leafletLayersControl"),__metadata("design:type",Object)],u.prototype,"layersControlConfig",void 0),__decorate([t.Input("leafletLayersControlOptions"),__metadata("design:type",Object)],u.prototype,"layersControlOptions",void 0),u=__decorate([t.Directive({selector:"[leafletLayersControl]"}),__metadata("design:paramtypes",[e.LeafletDirective])],u);var c=function(){function e(e,t){this.baseLayers=e,this.overlays=t}return e}(),f=function(){function e(e){this.leafletDirective=new n(e),this.controlLayers=new p}return e.prototype.ngOnInit=function(){this.leafletDirective.init(),this.controlLayers.init({baseLayers:this.baseLayers},this.layersControlOptions).addTo(this.leafletDirective.getMap()),this.syncBaseLayer()},e.prototype.ngOnChanges=function(e){e.baseLayers&&this.setBaseLayers(e.baseLayers.currentValue,e.baseLayers.previousValue)},e.prototype.setBaseLayers=function(e,t){this.controlLayers.setLayersControlConfig(new c(e),new c(t)),this.syncBaseLayer()},e.prototype.syncBaseLayer=function(){var e,t=this.leafletDirective.getMap(),r=s.mapToArray(this.baseLayers);t.eachLayer(function(t){e=r.find(function(e){return t===e})}),null!=e?this.baseLayer=e:r.length>0&&(this.baseLayer=r[0],this.baseLayer.addTo(t))},e}();__decorate([t.Input("leafletBaseLayers"),__metadata("design:type",Object)],f.prototype,"baseLayers",void 0),__decorate([t.Input("leafletLayersControlOptions"),__metadata("design:type",Object)],f.prototype,"layersControlOptions",void 0),f=__decorate([t.Directive({selector:"[leafletBaseLayers]"}),__metadata("design:paramtypes",[e.LeafletDirective])],f),e.LeafletModule=function(){function e(){}return e}(),e.LeafletModule=__decorate([t.NgModule({imports:[],exports:[e.LeafletDirective,a,u,f],declarations:[e.LeafletDirective,a,u,f],providers:[]})],e.LeafletModule);var y=function(){function e(){}return e.prototype.diffLayers=function(e,t){var r,n;return r=s.mapSubtract(t,e),n=s.mapSubtract(e,t),new l(r,n)},e}(),d=function(){function e(e,t,r){this.type=e,this.url=t,this.options=r}return e.createTileLayer=function(e){var t;switch(e.type){case"xyz":t=L.tileLayer(e.url,e.options);break;case"wms":default:t=L.tileLayer.wms(e.url,e.options)}return t},e.createTileLayers=function(t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=e.createTileLayer(t[n]));return r},e.prototype.createTileLayer=function(){return e.createTileLayer(this)},e}();e.LeafletDirectiveWrapper=n,e.LeafletControlLayersUtil=y,e.LeafletLayersUtil=o,e.LeafletTileLayerDefinition=d,Object.defineProperty(e,"__esModule",{value:!0})});